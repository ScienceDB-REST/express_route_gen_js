//
// GET REQUESTS
//
// get all <%- namePl %>
router.get('/<%- namePlLc %>', <% include ../partials/acl_middleware %> function(req, res) {
  models.
  <%- name %>.findAll(helper.searchPaginate(req,
    <%- JSON.stringify(typeAttributes['string'] || []) %>)).then(function(
    <%- namePl %>) {
    res.json(<%- namePl %>);
  }).catch(function(err) {
    res.status(500).json(err)
  })
});

// get single <%- name %>
router.get('/<%- nameLc %>/:id', <% include ../partials/acl_middleware %> function(req, res) {
  w = {
    where: {
      id: req.params.id
    }
  }
  i = helper.includeAssociations(req)
  models.
  <%- name %>.find(objectAssign(w,i)).then(function(x) {
    res.json(x);
  }).catch(function(err) {
    res.status(500).json(err)
  })
});

// get example CSV for subsequent bulk create
router.get('/<%- namePlLc %>/example_csv', <% include ../partials/acl_middleware %> function(req, res) {
  var params = JSON.parse(req.query.array);
  var fileType = 'csv';

  if('excel' in req.query && req.query.excel){
        fileType = 'excel';
  }

  models.
  <%- name %>.findAll({
        where: {
            id: params
        }
    }).then(function(<%- namePl %>) {
    if(fileType !== 'excel'){
      res.set('Content-Disposition', 'filename="' + '<%- name %>' + '.csv"');
      res.csv(<%- namePl %>.map(item => item.dataValues), true);
    }
    else{
      var workbook = new excel.Workbook();
      var worksheet = workbook.addWorksheet('<%- namePl %>');
      helper.sendExcel(<%- namePl %>.map(item => item.dataValues), res, workbook, worksheet, tempfile('.xlsx'), '<%- name %>');
    }
  }).catch(function(err) {
    res.status(500).json(err)
  })
})

// get for vue-table
router.get('/<%- namePlLc %>/vue_table', <% include ../partials/acl_middleware %> function(req, res) {
  helper.vueTable(req, models.
    <%- name%>,
    <%- JSON.stringify(typeAttributesTable['string'] || []) %>).then(
    function(x) {
      res.json(x)
    }).catch(function(err) {
      res.status(500).json(err)
    })
});

// get <%- name %> Data-Model definition 
router.get('/<%- namePlLc %>/definition', function(req, res) {
    models.
    <%- name %>.findAll().then(function(<%- namePl %>) {
        var modelData = helper.dataModel(<%- namePl %>);
        res.json(modelData);
    }).catch(function(err) {
        res.status(500).json(err)
    });
});
